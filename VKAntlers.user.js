// ==UserScript==
// @name         VKAntlers
// @namespace    https://github.com/Pocket-Deer/VKAntlers
// @version      1.2
// @description  Make it more useful!
// @author       Pocket Deer
// @homepage     https://github.com/Pocket-Deer/VKAntlers
// @updateURL    https://github.com/Pocket-Deer/VKAntlers/raw/master/VKAntlers.user.js
// @downloadURL  https://github.com/Pocket-Deer/VKAntlers/raw/master/VKAntlers.user.js
// @include      *://vk.com/*
// @include      *://*.vk.com/*
// @match        *://vk.com/*
// @match        *://*.vk.com/*
// @match        *://userapi.com/*
// @match        *://*.userapi.com/*
// @match        *://*.userstyles.org/*
// @match        https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap
// @require      http://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js
// @run-at       document-start
// @noframes
// ==/UserScript==

// ========================================================================
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏—Å—Ö–æ–¥–Ω–∏–∫ JQuery
var jquery_script = function() {
    var tmp = null;
    window.jQuery.ajax({ type: "GET",
                        url: 'https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js',
                        async: false,
                        success : function(text)
                        {
                            tmp = text;
                        }
                       });
    return tmp;
}();

var jquery = window.document.createElement('script');
jquery.type = 'text/javascript';
jquery.append(window.document.createTextNode(jquery_script));
(window.document.body || window.document.head || window.document.documentElement).append(jquery);

// ========================================================================
// –ò—Å—Ö–æ–¥–Ω—ã–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
var main = function() {

    // VKAntlers loves you!
    // --------------------------------------------------------------------
    // –û—á–µ–≤–∏–¥–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
    var $ = window.jQuery;

    // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    var vka_dev = false;

    // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
    var vka_config_default = {
        // version
        version: "1.2",

        // style
        custom_theme: false,
        custom_theme_type: "dark",
        custom_theme_autotoggle: false,
        ctt_end: "8",
        ctt_start: "20",
        custom_theme_icon: false,
        custom_hashtags: false,
        custom_back_button: true,
        hide_names: false,
        hide_messages: false,
        hide_photo: false,

        // left menu customization
        custom_left_menu: false,
        vka_l_pr: "–ú–æ—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",
        vka_l_nwsf: "–ù–æ–≤–æ—Å—Ç–∏",
        vka_l_msg: "–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä",
        vka_l_fr: "–î—Ä—É–∑—å—è",
        vka_l_gr: "–°–æ–æ–±—â–µ—Å—Ç–≤–∞",
        vka_l_ph: "–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏",
        vka_l_aud: "–ú—É–∑—ã–∫–∞",
        vka_l_vid: "–í–∏–¥–µ–æ",

        // text
        msg_changer: false,
        msg_changer_type: "",
        cipher: false,
        cipher_type: "none",
        custom_font: false,
        custom_font_type: "none",
        custom_font_css: "none",
        custom_font_size: "14",

        // patches
        unread: false,
        untype: false,
        unnotify: false,
        offline: false,
        full_offline: false,
        autolikes: false,
        antlers_exploit: false,

        //others
        rainbow_text: false,

        // development
        dev_alerts: false,
        dev_msg: false
    };

    // –ü–æ–¥–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞ —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    var vka_config = JSON.parse(localStorage.getItem("vka_config"));
    if (vka_config){
        // –°–æ–æ–±—â–∞–µ—Ç –æ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ñ–∏–≥–∞
        console.log ("Config loaded successfully!");
        //console.log ("Config is: " + JSON.stringify(vka_config)); // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Å—å –∫–æ–Ω—Ñ–∏–≥
    } else {
        // –°—Ç–∞–≤–∏—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∞
        console.log('Config not exists! Default config loaded!');
        vka_config = vka_config_default;
        localStorage.setItem("vka_config", JSON.stringify(vka_config));
        // TODO: –£–±—Ä–∞—Ç—å –∫–æ—Å—Ç—ã–ª—å —Å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π –∏–∑-–∑–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞. –ê –º–æ–∂–µ—Ç –∏ –Ω–µ –Ω–∞–¥–æ?
        // –ü—Ä–∏–∫–æ–ª –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ MutationObserver - –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∂–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞
        location.reload();
    };

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏
    // TODO: –°–¥–µ–ª–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—à—å –ø—É–Ω–∫—Ç–æ–≤ –∫–æ–Ω—Ñ–∏–≥–∞, –∞ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è—Ç—å –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
    if(vka_config_default.version > vka_config.version){
        console.log ("Config updated! From verion: " + vka_config.version + " to: " + vka_config_default.version);
        vka_config = vka_config_default;
        localStorage.setItem("vka_config", JSON.stringify(vka_config));
        // TODO: –£–±—Ä–∞—Ç—å –∫–æ—Å—Ç—ã–ª—å —Å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π –∏–∑-–∑–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞. –ê –º–æ–∂–µ—Ç –∏ –Ω–µ –Ω–∞–¥–æ?
        // –ü—Ä–∏–∫–æ–ª –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ MutationObserver - –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∂–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞
        location.reload();
    }

    // –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö—ç—à—Ç–µ–≥–æ–≤
    var hashtag_list = ["—Ñ–ª–µ–π–º–ª—É—á—à–∏–π", "–∑–∞–¥–æ–Ω–∞—Ç—å", "—Ç–µ–º–Ω–∞—è—Ç—ë–º–∞", "–¥–∞", "–¥–∏—Ä–æ—Ö–µ—Ä–µ–ª", "–∞—á—ë\)", "—Å–∏–¥–∏–¥–æ–º–∞–±–ª—ç–¥", "—Ñ—ã–≤–∞–ø—Ä–æ–ª–¥–∂—ç", "missingno",
                        "—Å–∏–∂—É–∞—Ö–µ—Ä–µ–ª", "–¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–û—á–∫–∞", "—Å–∫–∏–±–∏–¥–∏–≤–∞–ø–∞", "–æ–π–¥–µ–≤–∞—á—å–∫–∏", "–Ω–∞—Å—Ç–∏–ª–µ", "—á–∞–π–≤—Å–µ–º—É–≥–æ–ª–æ–≤–∞", "–º—Ä–∞—Ä—Ñ",
                        "–≥–æ–±—É—Ö–∞—Ç—å", "—Å–∫–∞–∑–æ—á–Ω–æ–µ–±–∞–ª–∏", "–¥–∏—Ä–ª–æ—Ö", "–ª–æ–∂–∫–∞", "300bucks", "—Å—Ç—ã–¥–ø–æ–∑–æ—Ä–Ω—ã–π", "ugotthat", "heybuddy", "—è–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≤—ã–∂–∏–≤—É",
                        "–Ω–µ—á–∏—Ç–∞–ª–û—á–∫–∞", "—Å–ª—ã—à—Ä–∞–±–æ—Ç–∞—Ç—å", "–∫–æ—Ñ–µ–º–∞–Ω–∏—è", "hohol", "(Ôªø Õ°¬∞ Õú ñ Õ°¬∞)", "–∞—Ç–ª–∏—à–Ω–∞", "42"];
    // –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ö—ç—à—Ç–µ–≥–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
    var logo_hashtag_text = hashtag_list[Math.floor(Math.random() * hashtag_list.length)];

    // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç–∞ —Å –ª–µ–≤—ã—Ö —Å–∞–π—Ç–æ–≤
    function vka_getraw(URL_Address){
        var tmp = null;
        $.ajax({ type: "GET",
                url: URL_Address,
                async: false,
                success : function(text){
                    tmp = text;
                }
               });
        return tmp;
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
    var vkantlers_menu = '<li class="HeaderNav__item deer" style="float: right;padding: 9px;"><a id="vkantlers_toggle" style="font-size: 20px;">ü¶å</a></li>';

    // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é –∏ –µ–≥–æ —Å—Ç–∏–ª—è [devchange]
    var vka_menu = vka_getraw("https://raw.githubusercontent.com/Pocket-Deer/VKAntlers/master/mainmenu.html");
    var vka_menu_css = vka_getraw("https://raw.githubusercontent.com/Pocket-Deer/VKAntlers/master/mainmenu.css");

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã [devchange]
    // –¢–µ–º–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç kandy (https://userstyles.org/styles/126419/vanilla-dark-2-vk)
    var dark_theme = vka_getraw('https://raw.githubusercontent.com/Pocket-Deer/VKAntlers/master/dark_style.css');


    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–∞ –¥–æ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ MutationObserver
    var preload = {
        custom_hashtags: function(){
            $(".top_home_link.fl_l").append('<div class="vka_hashtags">#' + logo_hashtag_text + "</div>");
            $(".top_home_link.fl_l").css({"display":"inline-flex","align-items":"center"});
            $(".top_home_logo").css({"margin":"0px 10px 0 0"});
        },
        mainmenu: function(){
            $('#top_nav').append(vkantlers_menu);
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –≤ –∫–æ–¥ —Å–∞–π—Ç–∞
            $("head").after(vka_menu_css);
            $(".HeaderNav__item.deer").append(vka_menu);
            vka_loadmenu();
        }
    };

    // –°–∞–º MutationObserver. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å—Ç–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –¥–æ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // class target - –ö–ª–∞—Å—Å, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—Å—è func
    function preload_load(class_target, func){
        var observer = new MutationObserver(function(mutations) {
            for (var i=0; i<mutations.length; i++) {
                var mutationAddedNodes = mutations[i].addedNodes;
                for (var j=0; j<mutationAddedNodes.length; j++) {
                    var node = mutationAddedNodes[j];
                    if (node.classList && node.classList.contains(class_target)) {
                        node.firstElementChild.innerHTML = node.firstElementChild.innerHTML.replace(/[\d.]+/g, function(m) { return 2 * m });
                        // don't hog resources any more as we've just done what we wanted
                        func();
                        observer.disconnect();
                        return;
                    }
                }
            }
        });
        observer.observe(document, {childList: true, subtree: true});
    };

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤—ã–∑–æ–≤–∞ –º–µ–Ω—é –∏ —Å–∞–º–æ –º–µ–Ω—é –Ω–∞ —Å–∞–π—Ç –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // TODO: –ü–æ—Ñ–∏–∫—Å–∏—Ç—å –∫–æ—Å—Ç—ã–ª—å —Å –∞—É–¥–∏–æ–∑–∞–ø–∏—Å—è–º–∏
    if(document.location.href.indexOf('audios') === -1){ //–ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–Ω–æ–ø–∫—É –≤ –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–∏
        preload_load('HeaderNav__item', preload.mainmenu);
    };

    // –§—É–Ω–∫—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∏—è –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–Ω–∞—á–æ–∫ –º–µ–Ω—é
    $(document).on("click", "#vkantlers_toggle", function(){
        console.log("Clicked on deer");
        $('.vka_parent').toggleClass('vka_parent_display');
    });

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
    $(document).on("click", ".vka_section", function() {
        $(this).next('.vka_innerBlock').toggleClass('vka_displayBlock');
    });

    // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–∞–º–æ–≥–æ –∞–¥–¥–æ–Ω–∞

    // –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥–æ–º
    function vka_config_set(name, value) {
        vka_config[name] = value;
        localStorage.setItem("vka_config", JSON.stringify(vka_config));
    };

    function vka_config_get(name){
        var vkac = JSON.parse(localStorage.getItem("vka_config"));
        return vkac[name];
    }

    // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
    $(".vka_content").ready(function() {
        $("input[type='checkbox'], input[type='radio']").on("click", function() {
            if (this.type == "radio" || this.type == "checkbox"){
                vka_config_set(this.id, this.checked);
            }
            if (this.type == "text"){
                vka_config_set(this.id, this.value);
            }
            vka_func(this.id);
        });
        $("input[type='text']").keyup(function() {
            vka_config_set(this.id, this.value);
            vka_func(this.id);
        });
        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é –ø–æ –∫–æ–Ω—Ñ–∏–≥—É
        //vka_loadmenu();
    });

    // –ó–∞–ø–æ–ª–Ω—è–µ—Ç –º–µ–Ω—é –ø–æ –∫–æ–Ω—Ñ–∏–≥—É
    function vka_loadmenu(){
        $(".vka_field, .vka_textarea").each(function(){
            if (this.type == "radio" || this.type == "checkbox"){
                $(this).prop("checked", vka_config_get(this.id));
                vka_func(this.id);
            } if (this.type == "text") {
                $(this).prop("value", vka_config_get(this.id));
                vka_func(this.id);
            }
        });
    }

    function vka_func(func_name){
        switch (func_name){
                // ---------------------------------------------------- Style
            case "custom_theme":
                if (vka_config.custom_theme == true && vka_config.custom_theme_type == "dark"){
                    $("head").append('<style type="text/css" id="vka_theme_dark">' + dark_theme + '</style>');
                } else {
                    $("#vka_theme_dark").remove();
                };
                break;

            case "custom_theme_type":
                break;

            case "custom_theme_autotoggle":
                break;

            case "ctt_end":
                break;

            case "ctt_start":
                break;

            case "custom_theme_icon":
                break;

            case "custom_hashtags":
                if (vka_config.custom_hashtags == true){
                    $(".top_home_link.fl_l").append('<div class="vka_hashtags">#' + logo_hashtag_text + "</div>");
                    $(".top_home_link.fl_l").css({"display":"inline-flex","align-items":"center","color":"var(--white)"});
                    $(".top_home_logo").css({"margin":"0px 10px 0 0"});
                } else {
                    $(".vka_hashtags").remove();
                };
                break;

            case "custom_back_button":
                $("body").on('DOMSubtreeModified', '.im-page--title-wrapper', function() {
                    if (vka_config.custom_back_button == true){
                        $(".im-page--back").css({"display":"block"});
                        $(".im-page--title").css({"align-items":"center", "flex-direction":"column", "padding":"8px 20px 20px 20px"});
                        $(".im-page--title-main").css({"overflow":"unset"});
                        $(".im-page--title-meta._im_page_peer_online").css({"margin-left":"0"});
                    } else {
                        $(".im-page--back").css({"display":"none"});
                        $(".im-page--title").css({"align-items":"center", "flex-direction":"none", "padding":"15px 20px"});
                        $(".im-page--title-main").css({"overflow":"hidden"});
                        $(".im-page--title-meta._im_page_peer_online").css({"margin-left":"8px"});
                    };
                });
                break;

            case "hide_names":
                if (vka_config.hide_names == true){
                    $('head').append('<style id="vka_hide_names" type="text/css">.nim-dialog .nim-dialog--name .nim-dialog--name-w{filter: blur(4px) !important} .im-right-menu .im-right-menu--text{filter: blur(4px) !important} .im-page--title-main{filter: blur(4px) !important} .im-mess-stack--lnk{filter: blur(4px) !important} ._im_replied_author_link{filter: blur(4px) !important} .top_profile_vkconnect_name{filter: blur(4px) !important} .top_profile_name{filter: blur(4px) !important} —éim-page-pinned--name{filter: blur(4px) !important} ._im_dialog_typing{filter: blur(4px) !important} ._im_typing_name{filter: blur(4px) !important}</style>');
                } else {
                    $('#vka_hide_names').remove();
                };
                break;

            case "hide_messages":
                if (vka_config.hide_messages == true){
                    $('head').append('<style id="vka_hide_messages" type="text/css">nim-dialog--inner-text{filter: blur(4px) !important} .nim-dialog--text-preview{filter: blur(4px) !important}</style>');
                } else {
                    $('#vka_hide_messages').remove()
                };
                break;

            case "hide_photo":
                if (vka_config.hide_photo == true){
                    //TODO: nim-peer--photo = —É–±–∏—Ä–∞–µ—Ç –ø–æ —Å—É—Ç–∏ –≤–æ–æ–±—â–µ –≤—Å–µ —Ñ–æ—Ç–∫–∏
                    $('head').append('<style id="vka_hide_photo"type="text/css">.nim-dialog.nim-dialog_classic .nim-dialog--photo{filter: blur(10px) !important} .im-prebody{filter: brightness(0) !important} .im-mess-stack--photo{filter: blur(10px) !important} .nim-dialog--photo{filter: blur(10px) !important} .top_profile_img{filter: brightness(0) !important} .top_profile_vkconnect_img{filter: brightness(0) !important} .im-page--aside-photo{filter: brightness(0) !important}</style>');
                } else {
                    $('#vka_hide_photo').remove()
                };
                break;

                // ---------------------------------------------------- Text

            case "msg_changer":
                break;

            case "msg_changer_type":
                break;

            case "cipher":
                break;

            case "cipher_type":
                break;

                // Custom left menu
                // TODO: –°–¥–µ–ª–∞—Ç—å —ç—Ç—É —Ö–µ—Ä—å –ø–æ–ø—Ä–æ—â–µ, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ñ—É–Ω–∫—Ü–∏–∏
            case "vka_l_pr":
            case "vka_l_nwsf":
            case "vka_l_msg":
            case "vka_l_fr":
            case "vka_l_gr":
            case "vka_l_ph":
            case "vka_l_aud":
            case "vka_l_vid":
            case "custom_left_menu":
                    if (vka_config.custom_left_menu == true){
                        $('#l_pr').find('.left_label.inl_bl').text(vka_config.vka_l_pr);
                        $('#l_nwsf').find('.left_label.inl_bl').text(vka_config.vka_l_nwsf);
                        $('#l_msg').find('.left_label.inl_bl').text(vka_config.vka_l_msg);
                        $('#l_fr').find('.left_label.inl_bl').text(vka_config.vka_l_fr);
                        $('#l_gr').find('.left_label.inl_bl').text(vka_config.vka_l_gr);
                        $('#l_ph').find('.left_label.inl_bl').text(vka_config.vka_l_ph);
                        $('#l_aud').find('.left_label.inl_bl').text(vka_config.vka_l_aud);
                        $('#l_vid').find('.left_label.inl_bl').text(vka_config.vka_l_vid);
                    } else {
                        $('#l_pr').find('.left_label.inl_bl').text(vka_config_default.vka_l_pr);
                        $('#l_nwsf').find('.left_label.inl_bl').text(vka_config_default.vka_l_nwsf);
                        $('#l_msg').find('.left_label.inl_bl').text(vka_config_default.vka_l_msg);
                        $('#l_fr').find('.left_label.inl_bl').text(vka_config_default.vka_l_fr);
                        $('#l_gr').find('.left_label.inl_bl').text(vka_config_default.vka_l_gr);
                        $('#l_ph').find('.left_label.inl_bl').text(vka_config_default.vka_l_ph);
                        $('#l_aud').find('.left_label.inl_bl').text(vka_config_default.vka_l_aud);
                        $('#l_vid').find('.left_label.inl_bl').text(vka_config_default.vka_l_vid);
                    }
                break;

            case "custom_font":
                if (vka_config.custom_font == true){
                    if (vka_config.custom_font_type == "none" || vka_config.custom_font_css == "none"){
                        alert ('–ü—Ä–µ–∂–¥–µ —á–µ–º –≤–∫–ª—é—á–∏—Ç—å —à—Ä–∏—Ñ—Ç - –≤—Å—Ç–∞–≤—å—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å—Å—ã–ª–∫–∏ –≤ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±–ª–æ–∫ <link href="—Å—Å—ã–ª–∫–∞">');
                    } else {
                        $("head").append(vka_config.custom_font_type);
                        $('head').append('<style id="vka_custom_font"> *{' + vka_config.custom_font_css + '} </style>');
                    }
                } else {
                    vka_config.custom_font_type = "none";
                    vka_config.custom_font_css = "none";
                    if ($('#vka_custom_font').length > 0){
                        $('#vka_custom_font').remove();
                        location.reload();
                    }
                    //location.reload();
                }
                break;

            case "custom_font_type":
                break;

            case "custom_font_size":
                break;

                // ---------------------------------------------------- Patches
            case "unread":
                break;

            case "untype":
                break;

            case "unnotify":
                break;

            case "offline":
                break;

            case "full_offline":
                break;

            case "autolikes":
                break;

            case "antlers_exploit":
                break;

                // ---------------------------------------------------- Others

            case "rainbow_text":
                if (vka_config.rainbow_text == true){
                $('head').append('<style id="vka_rainbow_text">@keyframes colorRotate { from {color: rgb(255, 0, 0);} 16.6% { color: rgb(255, 0, 255);} 33.3% {color: rgb(0, 0, 255);} 50% {color: rgb(0, 255, 255);} 66.6% {color: rgb(0, 255, 0); } 83.3% {color: rgb(255, 255, 0);} to {color: rgb(255, 0, 0);}} a, span{animation: colorRotate 6s linear 0s infinite;}');
                } else {
                $('#vka_rainbow_text').remove();
                }
                    break;

            case "dev_alerts":
                break;

            case "dev_msg":
                break;

            default:
                break;

        }
    }

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ —Ä–∞–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    // –ó–¥–µ—Å—å –≤—Å–µ - –Ω–µ—á–∏—Ç–∞–ª–∫–∞, –Ω–µ–ø–∏—Å–∞–ª–∫–∞, –æ—Ñ—Ñ–ª–∞–π–Ω, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    (function(send){
        XMLHttpRequest.prototype.send = function(body) {
            // –ó–∞–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            if (/act=a_send/.test(body) && vka_config.msg_changer == true) {
                var newstr = body.replace(/msg=/i, 'msg=' + vka_config.msg_changer_type + ' ');
                body = newstr;
            };
            // –ù–µ—á–∏—Ç–∞–ª–∫–∞
            if (/act=a_mark_read/.test(body) && vka_config.unread == true) {
                console.log("READ ABORTED!");
                XMLHttpRequest.abort();
            }
            // –ù–µ–ø–∏—Å–∞–ª–∫–∞
            if (/act=a_activity/.test(body) && /type=typing/.test(body) && vka_config.untype == true) {
                console.log("TYPING ABORTED!");
                XMLHttpRequest.abort();
            }
            // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            if (/act=a_clean_notify/.test(body) && vka_config.unnotify == true) {
                console.log("MARKED ABORTED!");
                XMLHttpRequest.abort();
            }
            // –ß–∞—Å—Ç–∏—á–Ω—ã–π –æ—Ñ—Ñ–ª–∞–π–Ω
            if ((/act=a_clean_notify/.test(body) || /act=a_activity/.test(body) || /type=typing/.test(body)
                 || /act=a_mark_read/.test(body) || /act=a_send/.test(body)) && vka_config.offline == true) {
                if (/act=a_send/.test(body)){
                    alert('–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å —á–∞—Å—Ç–∏—á–Ω—ã–º –æ—Ñ—Ñ–ª–∞–π–Ω–æ–º! –ß—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å –µ–≥–æ - —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö VKAntlers –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–∞—Ç—á–∏" —Å –ø—É–Ω–∫—Ç–∞ "–ß–∞—Å—Ç–∏—á–Ω—ã–π –æ—Ñ—Ñ–ª–∞–π–Ω"');
                };
                XMLHttpRequest.abort();
            }
            send.call(this, body);
        };
    })(XMLHttpRequest.prototype.send);

    // End of VKAntlers script! There is nothing next!
    // --------------------------------------------------------------------
};

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã—à–µ—Å—Ç–æ—è—â–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
var code = main.toString().match(/^.+?\{([\s\S]+)\}$/)[1];
var script = document.createElement('script');
script.type = 'text/javascript';
script.appendChild(document.createTextNode(code));
(document.body || document.head || document.documentElement).appendChild(script);
// ========================================================================
